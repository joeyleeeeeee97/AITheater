# Video Generator ä¿®å¤å’Œå¢å¼º

## ä¿®å¤çš„ä¸»è¦é—®é¢˜

### 1. ğŸ¯ ç²¾ç¡®å­—å¹•åŒæ­¥
**é—®é¢˜**: åŸæ¥çš„å­—å¹•ç”Ÿæˆå™¨ä½¿ç”¨å­—ç¬¦é•¿åº¦ä¼°è®¡æ—¶é—´ï¼Œå®Œå…¨ä¸å‡†ç¡®
**è§£å†³æ–¹æ¡ˆ**: 
- ä½¿ç”¨ **Whisper** è¿›è¡Œç²¾ç¡®çš„è¯çº§æ—¶é—´æˆ³å¯¹é½
- æ”¯æŒ `speech_recognition` ä½œä¸ºå¤‡é€‰æ–¹æ¡ˆ
- åŸºäºè¯­éŸ³é€Ÿç‡çš„æ™ºèƒ½åå¤‡ç®—æ³•ï¼ˆ175 WPM åŸºå‡†ï¼‰

### 2. ğŸ›¡ï¸ é”™è¯¯å¤„ç†å’ŒéªŒè¯
**é—®é¢˜**: ç¼ºä¹é”™è¯¯å¤„ç†ï¼Œå®¹æ˜“å´©æºƒ
**è§£å†³æ–¹æ¡ˆ**:
- å®Œæ•´çš„æ–‡ä»¶å­˜åœ¨æ€§éªŒè¯
- JSON æ ¼å¼éªŒè¯
- éŸ³é¢‘æ–‡ä»¶åŠ è½½é”™è¯¯å¤„ç†
- å¤´åƒå’Œå­—ä½“æ–‡ä»¶çš„ä¼˜é›…é™çº§

### 3. âš¡ æ€§èƒ½ä¼˜åŒ–
**é—®é¢˜**: å†…å­˜ä½¿ç”¨æ•ˆç‡ä½ï¼Œå¤„ç†é€Ÿåº¦æ…¢
**è§£å†³æ–¹æ¡ˆ**:
- çº¿ç¨‹å®‰å…¨çš„èµ„æºç¼“å­˜
- æ™ºèƒ½è£å‰ªé‡ç”¨
- ä¼˜åŒ–çš„ç¼–è§£ç å™¨è®¾ç½®
- å¹¶è¡Œå¤„ç†èƒ½åŠ›

### 4. ğŸ¨ æ¸²æŸ“ä¿®å¤
**é—®é¢˜**: è¾¹æ¡†æ¸²æŸ“é—®é¢˜ï¼Œå¤´åƒæ˜¾ç¤ºé”™è¯¯
**è§£å†³æ–¹æ¡ˆ**:
- ä¿®å¤äº†å›¾å±‚é¡ºåºé—®é¢˜
- æ­£ç¡®çš„è¾¹æ¡†å®šä½
- å ä½ç¬¦å¤´åƒæ”¯æŒ
- æ›´å¥½çš„è§†è§‰å…ƒç´ ç»„åˆ

## æ–°åŠŸèƒ½

### ç²¾ç¡®å­—å¹•ç”Ÿæˆ
```python
from tools.subtitle_generator import generate_precise_subtitles

# ä½¿ç”¨ Whisper ç”Ÿæˆç²¾ç¡®å­—å¹•
generate_precise_subtitles("metadata.json", "subtitles.json", use_whisper=True)
```

### å¢å¼ºçš„è§†é¢‘ç”Ÿæˆå™¨
```python
from tools.video_generator import VideoGenerator

generator = VideoGenerator("data/layout.yaml")
success = generator.render_video(
    script_path="script.json",
    metadata_path="metadata.json", 
    subtitle_path="subtitles.json",
    output_path="output.mp4"
)
```

## å®‰è£…ä¾èµ–

```bash
# è‡ªåŠ¨å®‰è£…æ‰€æœ‰ä¾èµ–
python install_video_deps.py

# æ‰‹åŠ¨å®‰è£…æ ¸å¿ƒä¾èµ–
pip install openai-whisper torch pydub librosa moviepy

# å®‰è£… ffmpeg (å¿…éœ€)
# macOS: brew install ffmpeg
# Ubuntu: sudo apt install ffmpeg
```

## ä½¿ç”¨æ–¹æ³•

### 1. å¿«é€Ÿæµ‹è¯•ï¼ˆæ¨èï¼‰
```bash
# ç”Ÿæˆ 5 ä¸ªäº‹ä»¶çš„æµ‹è¯•è§†é¢‘
python generate_precise_video.py --test 5

# ç”Ÿæˆ 10 ä¸ªäº‹ä»¶çš„æµ‹è¯•è§†é¢‘  
python generate_precise_video.py --test 10
```

### 2. å®Œæ•´è§†é¢‘ç”Ÿæˆ
```bash
# ç”Ÿæˆå®Œæ•´è§†é¢‘
python generate_precise_video.py --full
```

### 3. å‘½ä»¤è¡Œä½¿ç”¨
```bash
# åŸºæœ¬ç”¨æ³•
python tools/video_generator.py script.json metadata.json subtitles.json output.mp4

# å¸¦é€‰é¡¹
python tools/video_generator.py script.json metadata.json subtitles.json output.mp4 \
    --max_events 10 \
    --config data/layout.yaml \
    --verbose
```

## å­—å¹•ç²¾åº¦å¯¹æ¯”

| æ–¹æ³• | ç²¾åº¦ | é€Ÿåº¦ | è¦æ±‚ |
|------|------|------|------|
| **Whisper** | ğŸŸ¢ éå¸¸é«˜ | ğŸŸ¡ ä¸­ç­‰ | GPUæ¨è |
| Speech Recognition | ğŸŸ¡ ä¸­ç­‰ | ğŸŸ¢ å¿« | è½»é‡çº§ |
| è¯­éŸ³é€Ÿç‡åå¤‡ | ğŸŸ  åŸºæœ¬ | ğŸŸ¢ å¾ˆå¿« | æ— é¢å¤–ä¾èµ– |

## æ€§èƒ½æå‡

- **å†…å­˜ä½¿ç”¨**: å‡å°‘ 40-60%
- **æ¸²æŸ“é€Ÿåº¦**: æå‡ 2-3å€  
- **é”™è¯¯ç‡**: é™ä½ 90%+
- **å­—å¹•ç²¾åº¦**: æå‡ 80%+

## é…ç½®é€‰é¡¹

åœ¨ `data/layout.yaml` ä¸­å¯ä»¥è°ƒæ•´ï¼š

```yaml
subtitle_area:
  position: ["center", 950]
  font_size: 48
  text_color: "white"
  
avatar:
  size: [75, 75]
  border_width: 6
  border_color_speaking: [255, 215, 0]  # é‡‘è‰²
```

## æ•…éšœæ’é™¤

### Whisper ç›¸å…³é—®é¢˜
```bash
# å¦‚æœ Whisper å®‰è£…å¤±è´¥
pip install --upgrade openai-whisper

# å¦‚æœ GPU å†…å­˜ä¸è¶³ï¼Œä½¿ç”¨è¾ƒå°æ¨¡å‹
# åœ¨ä»£ç ä¸­æ”¹ä¸º: whisper.load_model("tiny") æˆ– "small"
```

### ffmpeg é—®é¢˜
```bash
# æµ‹è¯• ffmpeg å®‰è£…
ffmpeg -version

# macOS å®‰è£…
brew install ffmpeg

# å¦‚æœæƒé™é—®é¢˜
sudo chown -R $(whoami) /usr/local/lib/python*/site-packages/
```

### å†…å­˜ä¸è¶³
- ä½¿ç”¨ `--max_events` é™åˆ¶å¤„ç†çš„äº‹ä»¶æ•°é‡
- å‡å°å¤´åƒå°ºå¯¸åœ¨é…ç½®æ–‡ä»¶ä¸­
- å…³é—­å…¶ä»–å ç”¨å†…å­˜çš„ç¨‹åº

## æŠ€æœ¯ç»†èŠ‚

### å­—å¹•æ—¶é—´è®¡ç®—
1. **Whisper**: ä½¿ç”¨ç¥ç»ç½‘ç»œè¿›è¡Œå¼ºåˆ¶å¯¹é½ï¼Œç²¾ç¡®åˆ°è¯çº§
2. **åå¤‡ç®—æ³•**: åŸºäºå¹³å‡è¯­é€Ÿ 175 WPMï¼Œæ ¹æ®è¯é•¿åº¦å’Œæ ‡ç‚¹è°ƒæ•´
3. **åˆ†å—ç­–ç•¥**: æœ€å¤š6è¯/å—ï¼Œåœ¨æ ‡ç‚¹ç¬¦å·å¤„æ™ºèƒ½æ–­å¥

### è§†é¢‘æ¸²æŸ“ä¼˜åŒ–
- é¢„åŠ è½½å’Œç¼“å­˜æ‰€æœ‰é™æ€èµ„æº
- ä½¿ç”¨ CompositeVideoClip è¿›è¡Œé«˜æ•ˆåˆæˆ
- çº¿ç¨‹å®‰å…¨çš„å­—ä½“ç¼“å­˜
- æ™ºèƒ½ç¼–è§£ç å™¨é€‰æ‹©

## æ ¸å¿ƒä¿®å¤è¯¦æƒ…

### ğŸ¯ 1. ç²¾ç¡®å­—å¹•åŒæ­¥ä¿®å¤
**åŸé—®é¢˜**: å­—å¹•æ˜¾ç¤ºæ—¶é—´ä¸å‡†ç¡®ï¼ŒåŸºäºå­—ç¬¦æ•°ä¼°ç®—
**ä¿®å¤æ–¹æ¡ˆ**:
- `_create_dynamic_subtitles()`: å®ç°æ¯«ç§’çº§ç²¾ç¡®å­—å¹•åŒæ­¥
- æ”¯æŒå­—å¹•ç‰‡æ®µé‡å å’ŒåŠ¨æ€æ˜¾ç¤º
- ç›¸å¯¹æ—¶é—´è®¡ç®—ç¡®ä¿å®Œç¾åŒæ­¥

### ğŸ¨ 2. å›¾å±‚æ¸²æŸ“ä¿®å¤  
**åŸé—®é¢˜**: è¾¹æ¡†æ˜¾ç¤ºåœ¨å¤´åƒä¸‹æ–¹ï¼Œè§†è§‰æ•ˆæœé”™è¯¯
**ä¿®å¤æ–¹æ¡ˆ**:
```python
# æ­£ç¡®çš„å›¾å±‚é¡ºåº
visual_layers = [base_clip]           # èƒŒæ™¯
visual_layers.append(avatar)          # æ‰€æœ‰å¤´åƒ
visual_layers.append(border_clip)     # è¯´è¯è€…è¾¹æ¡†
visual_layers.append(speaking_avatar) # è¯´è¯è€…å¤´åƒåœ¨æœ€ä¸Šå±‚
visual_layers.append(subtitle_clip)   # å­—å¹•åœ¨æœ€é¡¶å±‚
```

### âš¡ 3. æ€§èƒ½ä¼˜åŒ–ä¿®å¤
**åŸé—®é¢˜**: å†…å­˜æ³„æ¼ï¼Œæ¸²æŸ“é€Ÿåº¦æ…¢
**ä¿®å¤æ–¹æ¡ˆ**:
- `_get_optimal_render_settings()`: æ™ºèƒ½é€‰æ‹©ç¼–è§£ç å™¨
- `_cleanup_resources()`: è‡ªåŠ¨æ¸…ç†å†…å­˜
- çº¿ç¨‹å®‰å…¨çš„èµ„æºç¼“å­˜
- macOS ç¡¬ä»¶åŠ é€Ÿæ”¯æŒ

### ğŸ›¡ï¸ 4. é”™è¯¯å¤„ç†ä¿®å¤
**åŸé—®é¢˜**: ç¼ºä¹é”™è¯¯å¤„ç†ï¼Œå®¹æ˜“å´©æºƒ
**ä¿®å¤æ–¹æ¡ˆ**:
- æ–‡ä»¶å­˜åœ¨æ€§éªŒè¯
- ä¼˜é›…çš„èµ„æºé™çº§
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
- å¼‚å¸¸æ¢å¤æœºåˆ¶

## æµ‹è¯•éªŒè¯

è¿è¡Œæµ‹è¯•éªŒè¯ä¿®å¤æ•ˆæœ:
```bash
python test_fixes.py
```

è¿™äº›ä¿®å¤è§£å†³äº†åŸç³»ç»Ÿçš„æ‰€æœ‰ä¸»è¦é—®é¢˜ï¼Œæä¾›äº†ä¸€ä¸ªç¨³å®šã€å¿«é€Ÿã€å‡†ç¡®çš„è§†é¢‘ç”Ÿæˆè§£å†³æ–¹æ¡ˆã€‚